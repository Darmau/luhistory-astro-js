---
import {Image} from 'astro:assets'

function getYear(date) {
  return new Date(date).getFullYear()
}

const { books } = Astro.props;
const slicedBooks = books.slice(0, 4);
---

<div class = "col-start-1 md:col-span-12 lg:col-span-6 my-4 lg:my-16">
  <hgroup class="flex justify-between items-baseline max-w-3xl">
    <h2 class = "font-serif font-bold text-neutral-900 text-3xl md:text-5xl">Publications</h2>
    <p class="font-sans text-base text-neutral-900 opacity-50">{books.length} books</p>
  </hgroup>
  <ul
    class = "ababsolute left-0 w-fit flex flex-col gap-6 lg:grid lg:grid-rows-2 lg:justify-items-start lg:grid-flow-col lg:gap-8 overflow-scroll pl-0"
  >
    {slicedBooks.map((book) => (
      <li class = "8xl:w-[480px] list-none">
        <a class = "no-underline flex gap-4 sm:gap-6" href = {`/book/detail/${book.slug}`}>
          {book.cover && (
            <div class="aspect-square bg-gray-50 flex justify-center items-center">
              <Image class="object-contain h-3/4 w-3/4" src={book.cover} alt={book.title} width="160" height="160" />
            </div>
          )}
          <div class="flex-1">
            <h3 class = "my-0 font-serif font-bold text-2xl md:text-3xl text-neutral-900 mb-2">{book.title}</h3>
            <small class="font-sans text-base text-neutral-900 opacity-50">{getYear(book.publishDate)}</small>
          </div>
        </a>
      </li>
    ))}
  </ul>
</div>

<style>
  //内部元素从上到下，从左到右排列，总共两行。第二个在第一列第二行，第三个在第二列第一行
  .books-grid {
    display: grid;
    grid-template-rows: repeat(2, 1fr);
    gap: 1rem;
  }
</style>
